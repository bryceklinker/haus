@using Haus.Api.Client.Rooms
@using Haus.Core.Models.Lighting
@using Haus.Core.Models.Rooms
@using Haus.Site.Host.Shared.Lighting

@inject IRoomsApiClient RoomsClient;

<MudGrid Class="pa-4">
    <MudItem xs="12">
        <MudTextField T="string" InputId="name" Label="Name" Value="Room.Name"/>
    </MudItem>
    <MudItem xs="12">
        <MudTextField T="int" InputId="occupancyTimeout" Label="Occupancy Timeout" Value="Room.OccupancyTimeoutInSeconds"/>
    </MudItem>
    <MudItem xs="12">
        <LightingView Lighting="Room.Lighting"
                      OnLightingChanged="HandleLightingChanged"/>    
    </MudItem>
</MudGrid>

@code {
    [Parameter]
    public required RoomModel Room { get; set; }

    private async Task HandleLightingChanged(LightingModel? lighting)
    {
        if (lighting == null || lighting == Room.Lighting)
        {
            return;
        }

        await RoomsClient.ChangeRoomLightingAsync(Room.Id, lighting);
        Room = await RoomsClient.GetRoomAsync(Room.Id) ?? Room;
    }
}